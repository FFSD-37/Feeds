<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Search People</title>
    <link rel="icon" type="image/*" href="https://ik.imagekit.io/FFSD0037/logo.jpeg?updatedAt=1746701257780">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/connect.css">
  </head>

  <body>
    <%- include('sidebar') %>
    <div class="content">
      <div class="header">
        <% if(type === "Kids") { %>
          <h1>üîç Discover New channels</h1>
        <% } else { %>
          <h1>üîç Discover People</h1>
        <% } %>
        <% if(type === "Kids") { %>
          <p>Connect, Learn and Grow together</p>
        <% } else { %>
          <p>Connect with amazing people in the community</p>
        <% } %>
      </div>

      <div class="search-container">
        <div class="search-wrapper">
          <span class="search-icon">üîé</span>
          <% if (type === "Kids") { %>
            <input type="text" id="searchInput" placeholder="Search by channel name..." />
          <% } else { %>
            <input type="text" id="searchInput" placeholder="Search by name or username..." />
          <% } %>
        </div>
      </div>

      <% if (type !== "Kids") { %>
        <div class="container">
          <div class="results-header">
            <span id="resultsCount"><%= users.length %></span> People Found
          </div>

          <% if (users.length === 0) { %>
            <div class="empty-state">
              <div class="empty-state-icon">üë•</div>
              <div class="empty-state-text">No people found</div>
            </div>
          <% } else { %>
            <ul id="peopleList">
              <% users.forEach((user) => { %>
                <li data-name="<%= user.display_name.toLowerCase() %>" data-username="<%= user.username.toLowerCase() %>">
                  <div class="profile">
                    <img src="<%= user.avatarUrl %>" alt="<%= user.display_name %>" />
                    <div class="info">
                      <a href="/profile/<%= user.username %>">
                        <div><strong><%= user.display_name %></strong></div>
                        <div>@<%= user.username %></div>
                      </a>
                      <div class="stats">
                        <div class="stat-item">
                          <span class="stat-icon">üë•</span>
                          <span class="stat-value"><%= user.followers %></span> Followers
                        </div>
                        <div class="stat-item">
                          <span class="stat-icon">‚ûï</span>
                          <span class="stat-value"><%= user.following %></span> Following
                        </div>
                      </div>
                    </div>
                  </div>
                </li>
              <% }) %>
            </ul>
          <% } %>
        </div>
      <% } else { %>
        <div class="container">
          <div class="results-header">
            <span id="resultsCount"><%= users.length %></span> Channels Found
          </div>
          <% if (users.length === 0) { %>
            <div class="empty-state">
              <div class="empty-state-icon">üë•</div>
              <div class="empty-state-text">No people found</div>
            </div>
          <% } else { %>
            <ul id="peoplelist">
              <% users.forEach((user) => { %>
                <li data-name="<%= user.channelName.toLowerCase() %>" data-username="<%= user.channelName.toLowerCase() %>">
                  <div class="profile">
                    <img src="<%= user.channelLogo %>" alt="<%= user.channelName %>" />
                    <div class="info">
                      <a href="/profile/<%= user.channelName %>">
                        <div><strong><%= user.channelName %></strong></div>
                        <div>@<%= user.channelName %></div>
                      </a>
                      <div class="stats">
                        <div class="stat-item"></div>
                        <div class="stat-item">
                          <span class="stat-icon">‚ûï</span>
                          <span class="stat-value"><%= user.channelMembers.length %></span> Members
                        </div>
                      </div>
                      <br />
                    </div>
                  </div>
                </li>
                <% }) %>
            </ul>
            <% } %>
        </div>
      <% } %>
    </div>

    <script>
      const searchInput = document.getElementById('searchInput');
      const peopleList = document.getElementById('peopleList');
      const resultsCount = document.getElementById('resultsCount');
      const listItems = peopleList ? peopleList.getElementsByTagName('li') : [];

      if (searchInput && peopleList) {
        searchInput.addEventListener('input', function() {
          const searchTerm = this.value.toLowerCase().trim();
          let visibleCount = 0;

          Array.from(listItems).forEach(item => {
            const name = item.getAttribute('data-name') || '';
            const username = item.getAttribute('data-username') || '';
            
            if (name.includes(searchTerm) || username.includes(searchTerm)) {
              item.style.display = '';
              visibleCount++;
            } else {
              item.style.display = 'none';
            }
          });

          if (resultsCount) {
            resultsCount.textContent = visibleCount;
          }
        });
      }
    </script>
    <script src="../js/connect.js"></script>
    <script src="../js/background.js"></script>
  </body>
</html>