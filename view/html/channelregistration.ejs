<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registration</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
      }

      body {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(45deg, #6b48ff, #6b48ff22);
        padding: 2rem;
      }

      .register-container {
        padding: 2rem;
        border-radius: 25px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border: 2px solid rgb(189, 31, 224);
        width: 100%;
        max-width: 500px;
        background: white;
      }

      .register-header {
        text-align: center;
        margin-bottom: 2rem;
      }

      .register-header h1 {
        color: #333;
        font-size: 1.8rem;
        margin-bottom: 0.5rem;
      }

      .form-group {
        margin-bottom: 1.5rem;
        position: relative;
      }

      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        color: #555;
        font-weight: 500;
      }

      .form-group input:not([type="radio"]),
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #ddd;
        border-radius: 5px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus,
      .form-group textarea:focus,
      .form-group select:focus {
        outline: none;
        border-color: #6b48ff;
      }

      .form-group textarea {
        min-height: 100px;
        resize: vertical;
      }

      .password-toggle {
        position: absolute;
        right: 10px;
        top: 37px;
        cursor: pointer;
        color: #666;
      }

      .error-message {
        color: #dc3545;
        font-size: 0.875rem;
        margin-top: 0.5rem;
        display: none;
      }

      .form-group.error input,
      .form-group.error textarea,
      .form-group.error select {
        border-color: #dc3545;
      }

      .form-group.error .error-message {
        display: block;
      }

      .checkbox-group {
        margin-top: 1.5rem;
      }

      .checkbox-group label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #333;
        cursor: pointer;
      }

      .submit-btn {
        width: 100%;
        padding: 0.75rem;
        background: #6b48ff;
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 1rem;
        cursor: pointer;
        transition: background-color 0.3s ease;
        margin-top: 1rem;
      }

      .submit-btn:hover {
        background: #5a3cd9;
      }

      .overlay {
        position: fixed;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        width: 30%;
        padding: 10px;
        background: rgb(145, 160, 212);
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        z-index: 1000;
        display: none;
      }

      .show-overlay {
        display: block;
      }

      .close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: red;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
      }

      .multiselect-dropdown {
        position: relative;
        width: 100%;
      }

      .select-box {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 6px;
        background-color: white;
        cursor: pointer;
        transition: all 0.3s;
      }

      .select-box:hover {
        border-color: #aaa;
      }

      .select-box.open {
        border-bottom-left-radius: 0;
        border-bottom-right-radius: 0;
        border-color: #4a90e2;
        box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
      }

      .selected-items {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        flex: 1;
      }

      .selected-item {
        background-color: #e1ecf4;
        color: #39739d;
        padding: 3px 8px;
        border-radius: 3px;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .selected-item i {
        cursor: pointer;
        font-size: 12px;
      }

      .placeholder {
        color: #999;
        font-size: 14px;
      }

      .dropdown-arrow {
        transition: transform 0.3s;
      }

      .open .dropdown-arrow {
        transform: rotate(180deg);
      }

      .dropdown-content {
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid #ddd;
        border-top: none;
        border-bottom-left-radius: 6px;
        border-bottom-right-radius: 6px;
        background-color: white;
        z-index: 100;
        display: none;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .open .dropdown-content {
        display: block;
      }

      .search-box {
        padding: 10px;
        border-bottom: 1px solid #eee;
        position: sticky;
        top: 0;
        background-color: white;
        z-index: 10;
      }

      .search-box input {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        outline: none;
      }

      .search-box input:focus {
        border-color: #4a90e2;
      }

      .options {
        list-style: none;
      }

      .option {
        padding: 10px 15px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .option:hover {
        background-color: #f5f5f5;
      }

      .option.selected {
        background-color: #e1ecf4;
      }

      .option input[type="checkbox"] {
        cursor: pointer;
      }

      .no-options {
        padding: 15px;
        text-align: center;
        color: #999;
        font-size: 14px;
      }

      @media (max-width: 480px) {
        body {
          padding: 1rem;
        }

        .register-container {
          padding: 1.5rem;
          max-width: 100%;
          margin: 1rem;
        }

        .register-header h1 {
          font-size: 1.5rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
          font-size: 0.9rem;
          padding: 0.6rem;
        }

        .submit-btn {
          font-size: 0.9rem;
          padding: 0.6rem;
        }

        .overlay {
          width: 90%;
        }
      }
    </style>
    <link rel="icon" type="image/*" href="https://ik.imagekit.io/FFSD0037/logo.jpeg?updatedAt=1746701257780">
  </head>

  <body>
    <%- include("sidebar") %>
    <div class="register-container">
      <div class="register-header">
        <h1>Create Account</h1>
      </div>
      <form id="registerForm" action="/signupChannel" method="POST" novalidate>
        <div class="form-group">
          <label for="channelName">Channel Name</label>
          <input
            type="text"
            id="channelName"
            name="channelName"
            placeholder="Channel name"
            required
          />
          <div class="error-message">Please enter unique Channel name</div>
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input
            type="password"
            id="password"
            name="password"
            placeholder="Password"
            title="Password must be at least 6 characters long, include one uppercase letter, one number, and one special character."
            required
          />
          <div class="error-message">Password should be valid</div>
          <span class="password-toggle" id="passwordToggle">üëÅÔ∏è</span>
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirm Password</label>
          <input
            type="password"
            id="confirmPassword"
            name="confirmPassword"
            placeholder="Password crosscheck"
            required
          />
          <div class="error-message">Password should match</div>
          <span class="password-toggle" id="confirmPasswordToggle">üëÅÔ∏è</span>
        </div>

        <label
          for="multiselect"
          style="display: block; margin-bottom: 8px; font-weight: 500"
          >Select Categories</label
        >
        <div class="multiselect-dropdown">
          <div class="select-box">
            <div class="selected-items"></div>
            <span class="placeholder">Select options...</span>
            <span class="dropdown-arrow"
              ><i class="fas fa-chevron-down"></i
            ></span>
          </div>
          <div class="dropdown-content">
            <div class="search-box">
              <input
                type="text"
                placeholder="Search options..."
                class="search-input"
              />
            </div>
            <ul class="options"></ul>
          </div>
          <input
            type="hidden"
            id="selectedCategories"
            name="selectedCategories"
          />
        </div>
        <input type="hidden" id="profileImageUrl" name="profileImageUrl" />

        <div class="form-group">
          <label for="pfp">Channel Logo (Optional)</label>
          <input type="file" name="pfp" id="pfp" accept="image/*" />
        </div>

        <div class="form-group">
          <label for="channelDescription">Channel Description</label>
          <textarea
            id="channelDescription"
            name="channelDescription"
            rows="4"
            cols="50"
            placeholder="Write your channel description here..."
            required
          ></textarea>
        </div>
        <div class="checkbox-group">
          <label>
            <input type="checkbox" id="terms" required />
            I agree to the
            <a href="#" onclick="openOverlay(event)">Terms & Conditions</a>
          </label>
          <div class="error-message">You must agree to the terms</div>
        </div>

        <button type="submit" class="submit-btn">Create Account</button>
      </form>
    </div>
    <div class="overlay" id="overlay">
      <button
        class="close-btn"
        onclick="document.getElementById('overlay').classList.remove('show-overlay')"
      >
        X
      </button>
      <h1>Terms & Conditions</h1>
      <div class="content">
        <h2>1. Introduction</h2>
        <p>
          Welcome to Feeds! By using our platform, you agree to these terms and
          conditions.
        </p>

        <h2>2. User Category info</h2>
        <h3>1. Kids</h3>
        <pre>
1. Education
2. Animation
3. Nature</pre
        >
        <h3>2. Students</h3>
        <pre>All</pre>
        <p><strong>Last Updated: February 2025</strong></p>
      </div>
    </div>

    <script>
      const form = document.getElementById("registerForm");
      const passwordInput = document.getElementById("password");
      const confirmPasswordInput = document.getElementById("confirmPassword");
      const passwordToggle = document.getElementById("passwordToggle");
      const confirmPasswordToggle = document.getElementById(
        "confirmPasswordToggle"
      );
      const selectedCategoriesInput = document.getElementById("selectedCategories");
      const imageupload = document.getElementById('pfp');

      const validatePassword = (password) => {
        return (
          password.length >= 6 &&
          /[A-Z]/.test(password) &&
          /[0-9]/.test(password) &&
          /[!@#$%^&*(),.?":{}|<>]/.test(password)
        );
      };

      document.querySelectorAll(".password-toggle").forEach((toggle) => {
        toggle.addEventListener("click", () => {
          const input = toggle.previousElementSibling.previousElementSibling;
          if (input.type === "password") {
            input.type = "text";
            toggle.textContent = "üëÅÔ∏è‚Äçüó®Ô∏è";
          } else {
            input.type = "password";
            toggle.textContent = "üëÅÔ∏è";
          }
        });
      });

      form.addEventListener("submit", (e) => {
        const passwordValid = validatePassword(form.password.value);
        const passwordsMatch =
          form.password.value === form.confirmPassword.value;
        const termsValid = form.terms.checked;

        // Show/hide errors
        document.querySelector("#password + .error-message").style.display =
          passwordValid ? "none" : "block";
        document.querySelector(
          "#confirmPassword + .error-message"
        ).style.display = passwordsMatch ? "none" : "block";
        document.querySelector("#terms ~ .error-message").style.display =
          termsValid ? "none" : "block";

        // Add/remove error classes
        passwordValid
          ? passwordInput.classList.remove("error")
          : passwordInput.classList.add("error");
        passwordsMatch
          ? confirmPasswordInput.classList.remove("error")
          : confirmPasswordInput.classList.add("error");

        if (!passwordValid || !passwordsMatch || !termsValid) {
          return;
        }

        form.submit();
      });

      async function getAuth() {
        let res = await fetch('/imagKitauth')
        return res;
      }

      imageupload.addEventListener('change', handleUpload);
      async function handleUpload() {
        const authResponse = await getAuth();

        if (!authResponse.ok) throw new Error("Failed to fetch auth details");

        const authData = await authResponse.json();
        var imagekit = new ImageKit({
          publicKey: "public_wbpheuS28ohGGR1W5QtPU+uv/z8=",
          urlEndpoint: "https://ik.imagekit.io/lidyx2zxm/",
        });

        var file = document.getElementById("pfp");
        imagekit.upload({
          file: file.files[0],
          fileName: file.files[0].name || "sample-file.jpg",
          tags: ["tag1"],
          responseFields: "tags",
          token: authData.token,
          signature: authData.signature,
          expire: authData.expire,
        }, function (err, result) {
          if (err) {
            console.log(err);
          } else {
            document.getElementById("profileImageUrl").value = result.url;
            console.log(result);
          }
        });
      }

      function openOverlay(event) {
        event.preventDefault();
        document.getElementById("overlay").classList.add("show-overlay");
      }

      document.addEventListener("DOMContentLoaded", function () {
        // Sample data - can be replaced with your own data
        const optionsData = [
          { value: "All", label: "All" },
          { value: "Education", label: "Education" },
          { value: "Animations", label: "Animations" },
          { value: "Games", label: "Games" },
          { value: "Memes", label: "Memes" },
          { value: "News", label: "News" },
          { value: "Tech", label: "Tech" },
          { value: "Vlog", label: "Vlog" },
          { value: "Entertainment", label: "Entertainment" },
          { value: "Sports", label: "Sports" },
          { value: "Nature", label: "Nature" },
          { value: "Music", label: "Music" },
          { value: "Marketing", label: "Marketing" },
          { value: "Fitness", label: "Fitness" },
          { value: "Lifestyle", label: "Lifestyle" },
        ];

        const multiselect = document.querySelector(".multiselect-dropdown");
        const selectBox = multiselect.querySelector(".select-box");
        const selectedItems = multiselect.querySelector(".selected-items");
        const placeholder = multiselect.querySelector(".placeholder");
        const dropdownContent = multiselect.querySelector(".dropdown-content");
        const searchInput = multiselect.querySelector(".search-input");
        const optionsList = multiselect.querySelector(".options");

        // State
        let selectedValues = [];
        let isOpen = false;

        // Initialize dropdown
        function initDropdown() {
          renderOptions(optionsData);
          updateSelectedItems();

          // Toggle dropdown
          selectBox.addEventListener("click", function (e) {
            e.stopPropagation();
            toggleDropdown();
          });

          // Close dropdown when clicking outside
          document.addEventListener("click", function () {
            if (isOpen) {
              closeDropdown();
            }
          });

          // Search functionality
          searchInput.addEventListener("input", function () {
            const searchTerm = this.value.toLowerCase();
            const filteredOptions = optionsData.filter((option) =>
              option.label.toLowerCase().includes(searchTerm)
            );
            renderOptions(filteredOptions);
          });
        }

        // Toggle dropdown
        function toggleDropdown() {
          if (isOpen) {
            closeDropdown();
          } else {
            openDropdown();
          }
        }

        function openDropdown() {
          multiselect.classList.add("open");
          isOpen = true;
          // Focus search input when dropdown opens
          setTimeout(() => {
            searchInput.focus();
          }, 0);
        }

        function closeDropdown() {
          multiselect.classList.remove("open");
          isOpen = false;
          // Clear search when closing
          searchInput.value = "";
          renderOptions(optionsData);
        }

        // Render options
        function renderOptions(options) {
          optionsList.innerHTML = "";

          if (options.length === 0) {
            optionsList.innerHTML =
              '<div class="no-options">No options found</div>';
            return;
          }

          options.forEach((option) => {
            const li = document.createElement("li");
            li.className = "option";
            if (selectedValues.includes(option.value)) {
              li.classList.add("selected");
            }

            li.innerHTML = `
                        <input type="checkbox" ${
                          selectedValues.includes(option.value) ? "checked" : ""
                        } 
                            data-value="${option.value}">
                        <span>${option.label}</span>
                    `;

            li.addEventListener("click", function (e) {
              // Don't toggle if clicking on the checkbox directly
              if (e.target.tagName !== "INPUT") {
                const checkbox = this.querySelector("input");
                checkbox.checked = !checkbox.checked;
                handleOptionChange(checkbox);
              }
            });

            const checkbox = li.querySelector("input");
            checkbox.addEventListener("change", function () {
              handleOptionChange(this);
            });

            optionsList.appendChild(li);
          });
        }

        // Handle option selection change
        function handleOptionChange(checkbox) {
          const value = checkbox.getAttribute("data-value");

          if (checkbox.checked) {
            if (!selectedValues.includes(value)) {
              selectedValues.push(value);
            }
          } else {
            selectedValues = selectedValues.filter((v) => v !== value);
          }

          updateSelectedItems();
          updateHiddenInput();
          renderOptions(optionsData); // Re-render to update selected state
        }

        function updateHiddenInput() {
          selectedCategoriesInput.value = JSON.stringify(selectedValues);
        }

        // Update selected items display
        function updateSelectedItems() {
          selectedItems.innerHTML = "";

          if (selectedValues.length === 0) {
            placeholder.style.display = "block";
            return;
          }

          placeholder.style.display = "none";

          selectedValues.forEach((value) => {
            const option = optionsData.find((o) => o.value === value);
            if (option) {
              const item = document.createElement("div");
              item.className = "selected-item";
              item.innerHTML = `
                            ${option.label}
                            <i class="fas fa-times" data-value="${value}"></i>
                        `;
              selectedItems.appendChild(item);
            }
          });

          // Add click event to remove buttons
          selectedItems.querySelectorAll(".fa-times").forEach((btn) => {
            btn.addEventListener("click", function (e) {
              e.stopPropagation();
              const value = this.getAttribute("data-value");
              selectedValues = selectedValues.filter((v) => v !== value);
              updateSelectedItems();
              updateHiddenInput();
              renderOptions(optionsData);
            });
          });
        }

        // Initialize the dropdown
        initDropdown();
      });
    </script>
    <script src="https://unpkg.com/imagekit-javascript/dist/imagekit.min.js"></script>
  </body>
</html>
