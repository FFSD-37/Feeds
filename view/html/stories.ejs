<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stories</title>
    <link rel="stylesheet" href="../css/stories.css">
    <link rel="icon" type="image/*" href="https://ik.imagekit.io/FFSD0037/logo.jpeg?updatedAt=1746701257780">
</head>
<body>
    <%- include('sidebar') %>
    <div class="stories-grid" id="stories-grid">
        <% const seenUsernames = {}; %>
        <% stories.forEach((story) => { %>
            <% if (!seenUsernames[story.username]) { %>
                <% seenUsernames[story.username] = true; %>
                <div class="story-container" onclick="openStory('<%= story.username %>')">
                    <div class="story-avatar-border">
                        <img src="<%= story.avatarUrl %>" alt="<%= story.username %>" class="story-avatar">
                    </div>
                    <div class="story-username"><%= story.username %></div>
                </div>
            <% } %>
        <% }) %>
    </div>

    <div class="story-viewer" id="story-viewer">
        <div class="close-story" onclick="closeStory()">âœ•</div>
        
        <div class="story-progress" id="story-progress-container"></div>
        
        <div class="story-header">
            <div class="user-info" id="story-user-info">
                <img src="/api/placeholder/64/64" alt="User profile" class="user-avatar-small" id="story-user-avatar">
                <span class="username" id="story-username">username</span>
                <span class="post-time" id="story-time"></span>
            </div>
        </div>
        
        <div class="story-view" id="story-view-container"></div>
        
        <div class="navigation">
            <div class="nav-left" onclick="previousStory()"></div>
            <div class="nav-right" onclick="nextStory()"></div>
        </div>
    </div>

<script>

const stories = JSON.parse('<%- JSON.stringify(stories) %>');
  const users = {};

  stories.forEach(story => {
    const username = story.username;
    
    if (!users[username]) {
      users[username] = {
        username: username,
        avatar: story.avatarUrl ,
        stories: []
      };
    }

    users[username].stories.push(story);
  });

    const storiesData = {
        currentUser: "<%= currUser %>",
        userStories: stories
    };
</script>
    
    <script src="../js/stories.js"></script>
    <script src="../js/background.js"></script>
</body>
</html>