<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reels</title>
    <link rel="stylesheet" href="../css/reels.css" />
  </head>

  <body>
    <div class="main-content">
      <div class="reels-container">
        <div class="reels-wrap">
          <div class="reels-feed">
            <% posts.forEach(post => { %>
            <div class="reel-video" data-post-id="<%= post._id || post.id %>">
              <video autoplay loop muted playsinline>
                <source src="<%= post.url %>" type="video/mp4" />
                Your browser does not support the video tag.
              </video>

              <div class="mute-toggle" onclick="toggleMute(this)">
                <svg
                  class="mute-icon"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="#fff"
                >
                  <path
                    d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zM4.27 3L3 4.27l4.73 4.73H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"
                  />
                </svg>
                <svg
                  class="unmute-icon"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="#fff"
                  style="display: none"
                >
                  <path
                    d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"
                  />
                </svg>
              </div>

              <div class="video-info">
                <div class="video-title"><%= post.content %></div>
                <div class="video-channel">
                  <img
                    class="channel-avatar"
                    src="<%= post.avatar %>"
                    alt="Avatar"
                  />
                  <span>
                    <a
                      href="/profile/<%= post.author %>"
                      style="text-decoration: none; color: white"
                    >
                      <%= post.author %>
                    </a>
                  </span>
                </div>
              </div>

              <div class="video-actions">
                <div
                  class="action-button like-button <%= post.liked ? 'liked' : '' %>"
                  data-post-id="<%= post._id || post.id %>"
                >
                  <div class="action-icon">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      height="24px"
                      viewBox="0 -960 960 960"
                      width="24px"
                      fill="#FFFFFF"
                    >
                      <path
                        d="M720-120H320v-520l280-280 50 50q7 7 11.5 19t4.5 23v14l-44 174h218q32 0 56 24t24 56v80q0 7-1.5 15t-4.5 15L794-168q-9 20-30 34t-44 14ZM240-640v520H80v-520h160Z"
                      />
                    </svg>
                  </div>
                  <div class="action-count like-count">
                    <%= post.likes || 0 %>
                  </div>
                </div>

                <div
                  class="action-button comment-button"
                  data-post-id="<%= post._id || post.id %>"
                >
                  <div class="action-icon">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      height="24px"
                      viewBox="0 -960 960 960"
                      width="24px"
                      fill="#FFFFFF"
                    >
                      <path
                        d="M80-80v-720q0-33 23.5-56.5T160-880h640q33 0 56.5 23.5T880-800v480q0 33-23.5 56.5T800-240H240L80-80Z"
                      />
                    </svg>
                  </div>
                  <div class="action-count comment-count">
                    <%= (post.comments || []).length %>
                  </div>
                </div>

                <div
                  class="action-button share-button"
                  data-post-id="<%= post._id || post.id %>"
                  data-post-url="<%= post.url %>"
                >
                  <div class="action-icon">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      height="24px"
                      viewBox="0 -960 960 960"
                      width="24px"
                      fill="#FFFFFF"
                    >
                      <path
                        d="M689.71-34Q624-34 578-79.71T532-190q0-7 3-21L286-353q-20.21 14.87-44.01 22.94Q218.18-322 191-322q-66 0-111.5-46T34-480q0-66 45.5-112.5T191-639q28 0 52.9 9.06 24.89 9.06 45.1 24.94l245-141q-1-6-1.5-12t-.5-11q0-66 46-112t112-46q65 0 111 46.5T847-769q0 65-46.21 111T690-612q-29.36 0-55.68-10T588-649L347-513q2 8.05 2.5 16.52.5 8.48.5 16.98t-.5 17.15Q349-453.7 346-445l240 137q22-19 47.45-29.5Q658.91-348 690-348q65.58 0 111.29 46Q847-256 847-190q0 65-46.29 110.5-46.3 45.5-111 45.5Z"
                      />
                    </svg>
                  </div>
                  <div class="action-count">Share</div>
                </div>
              </div>
            </div>
            <% }) %>
          </div>
        </div>

        <aside id="comments-panel" class="comments-panel" aria-hidden="true">
          <div class="comments-top">
            <button
              id="close-comments"
              class="close-comments"
              aria-label="Close comments"
            >
              ‚Üê
            </button>
            <h3 id="comments-title">Comments</h3>
            <div id="comments-count-small" class="comments-count-small">0</div>
          </div>
          <div id="comments-list" class="comments-list"></div>
          <form id="comment-form" class="comment-form">
            <textarea
              id="comment-text"
              placeholder="Add a public comment..."
              rows="3"
              required
            ></textarea>
            <div class="comment-actions">
              <button type="submit" class="comment-post-btn">Post</button>
            </div>
          </form>
        </aside>

        <div
          id="comments-backdrop"
          class="comments-backdrop"
          aria-hidden="true"
        ></div>
      </div>
    </div>

    <%- include('sidebar') %>
    <script src="../js/reels.js"></script>
  </body>
</html>
