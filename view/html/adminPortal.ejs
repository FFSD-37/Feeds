<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="../css/adminPortal.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="icon" type="image/*" href="https://ik.imagekit.io/FFSD0037/logo.jpeg?updatedAt=1746701257780">
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar">
      <a href="#" class="navbar-brand">AdminPortal-Feeds</a>
      <!-- <div class="navbar-search">
        <i class="fas fa-search search-icon"></i>
        <input type="text" placeholder="Search..." />
      </div> -->
      <div class="navbar-right">
        <!-- <div class="navbar-item">
          <i class="fas fa-bell"></i>
          <span class="notification-badge">3</span>
        </div>
        <div class="navbar-item">
          <i class="fas fa-envelope"></i>
          <span class="notification-badge">5</span>
        </div> -->
        <div class="user-profile">
          <div class="user-avatar">F</div>
          <span class="user-name">Admin</span>
        </div>
      </div>
    </nav>

    <!-- Sidebar Toggle Button -->
    <button class="sidebar-toggle" id="sidebarToggle">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="menu-section">
        <div class="menu-header">Main</div>
        <ul class="menu-items">
          <li class="menu-item active" id="menuDashboard">
            <i class="fas fa-tachometer-alt"></i> Dashboard
          </li>
          <!-- <li class="menu-item"><i class="fas fa-chart-line"></i> Analytics</li> -->
          <!-- <li class="menu-item"><i class="fas fa-calendar"></i> Calendar</li> -->
        </ul>
      </div>
      <div class="menu-section">
        <div class="menu-header">Management</div>
        <ul class="menu-items">
          <li class="menu-item" id="menuUsers">
            <i class="fas fa-users"></i> Users
          </li>
          <li class="menu-item" id="menuReviews">
            <i class="fas fa-comment"></i> Reviews
          </li>
        </ul>
      </div>
      <div class="menu-section">
        <div class="menu-header">Support</div>
        <ul class="menu-items">
          <li class="menu-item" id="menuReports">
            <i class="fas fa-ticket-alt"></i> Tickets
          </li>
        </ul>
      </div>
    </aside>

    <main class="main-content" id="mainContent">
      <h1 class="page-title">Dashboard</h1>

      <!-- Stats Cards -->
      <div class="dashboard-stats">
        <div class="stat-card">
          <div
            class="stat-icon"
            style="background-color: #e5f8ed; color: #28a745"
          >
            <i class="fas fa-users"></i>
          </div>
          <div class="stat-info">
            <h3><%- total_users %></h3>
            <p>Total Users</p>
          </div>
        </div>
        <div class="stat-card">
          <div
            class="stat-icon"
            style="background-color: #e5f6ff; color: var(--info)"
          >
            <i class="fas fa-image"></i>
          </div>
          <div class="stat-info">
            <h3><%- total_posts %></h3>
            <p>Total Posts</p>
          </div>
        </div>
        <div class="stat-card">
          <div
            class="stat-icon"
            style="background-color: #fff4e5; color: #ff9800"
          >
            <i class="fas fa-chart-line"></i>
          </div>
          <div class="stat-info">
            <h3>₹<%- total_revenue %></h3>
            <p>Total Revenue</p>
          </div>
        </div>
        <div class="stat-card">
          <div
            class="stat-icon"
            style="background-color: #ffe5e5; color: var(--danger)"
          >
            <i class="fas fa-ticket-alt"></i>
          </div>
          <div class="stat-info">
            <h3><%- total_tickets %></h3>
            <p>Support Tickets</p>
          </div>
        </div>
      </div>

      <!-- Chart & Activities -->
      <div class="content-row" id="dashboardSection">
        <div class="content-card recent-purchases-class">
          <div class="card-header">
            <div class="card-title">Recent Purchases</div>
          </div>
          <div
            class="table-container"
            style="max-height: 300px; overflow-y: auto"
          >
            <% if(allOrders && allOrders.length > 0) { %>
            <table class="data-table">
              <thead>
                <tr>
                  <th>Order ID</th>
                  <th>Customer</th>
                  <th>Date</th>
                  <th>Amount</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <% allOrders.forEach(function(order) { %>
                <tr>
                  <td>#<%= order.id %></td>
                  <td><%= order.username %></td>
                  <td>
                    <%= new Date(order.createdAt).toLocaleDateString('en-US', {
                    year: 'numeric', month: 'short', day: 'numeric' }) %>
                  </td>
                  <td>₹<%= order.amount %></td>
                  <td>
                    <span
                      class="status-badge <%= order.status === 'Completed' ? 'status-active' : 'status-pending' %>"
                    >
                      <% if (order.status === 'Completed') { %>
                      <i class="fas fa-check-circle"></i> Completed <% } else if
                      (order.status === 'Pending') { %>
                      <i class="fas fa-hourglass-half"></i> Pending <% } %>
                    </span>
                  </td>
                </tr>
                <% }); %>
              </tbody>
            </table>
            <% } else { %>
            <div class="no-data">No orders found</div>
            <% } %>
          </div>
        </div>
        <div class="content-card">
          <div class="card-header">
            <div class="card-title">Latest Users</div>
          </div>
          <ul
            class="recent-activities"
            style="max-height: 300px; overflow-y: auto"
          >
            <% if (allUsersInOrder && allUsersInOrder.length > 0) { %> <%
            allUsersInOrder.forEach(user => { %>
            <li class="activity-item">
              <div class="activity-icon" style="background-color: #e5f8ed">
                <i class="fas fa-user"></i>
              </div>
              <div class="activity-info">
                <div class="activity-title"><%= user.username %></div>
                <div class="activity-time"><%= user.email %></div>
              </div>
            </li>
            <% }) %> <% } else { %>
            <li class="activity-item">
              <div class="activity-info">
                <div class="activity-title">No users found</div>
              </div>
            </li>
            <% } %>
          </ul>
        </div>
      </div>

      <div id="usersSection" style="display: none">
        <h2 class="page-title">All Users</h2>
        <% if(allUsers && allUsers.length > 0) { %>
        <table class="data-table">
          <thead>
            <tr>
              <th>User ID</th>
              <th>Username</th>
              <th>Email</th>
              <th>Joined</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% allUsers.forEach(function(user) { %>
            <tr>
              <td><%= user.id %></td>
              <td><%= user.username %></td>
              <td><%= user.email %></td>
              <td>
                <%= new Date(user.createdAt).toLocaleDateString('en-US') %>
              </td>
              <td>
                <button
                  id="fetchOverlay"
                  class="manage-user-btn"
                  title="Manage User"
                  data-id="<%= user.id %>"
                  data-username="<%= user.username %>"
                  data-email="<%= user.email %>"
                >
                  <i class="fas fa-user-cog"></i>
                </button>
              </td>
            </tr>
            <% }); %>
          </tbody>
        </table>
        <% } else { %>
        <div class="no-data">No users found</div>
        <% } %>
      </div>

      <div id="reportSection" style="display: none">
        <h2 class="page-title">Report Section</h2>
        <% if(allReports && allReports.length > 0) { %>
        <table class="data-table">
          <thead>
            <tr>
              <th>Report ID</th>
              <th>Post_ID</th>
              <th>Author</th>
              <th>Report Number</th>
              <th>Reporter</th>
              <th>Reason</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <% allReports.forEach(function(report) { %>
              <td><%= report._id %></td>
              <td><%= report.post_id %></td>
              <td><%= report.post_author %></td>
              <td><%= report.report_number %></td>
              <td><%= report.user_reported %></td>
              <td><%= report.reason %></td>
              <td>
                <span
                  class="status-badge <%= report.status === 'Completed' ? 'status-active' : 'status-pending' %>"
                >
                  <% if (report.status === 'Completed') { %>
                  <i class="fas fa-check-circle"></i> Completed <% } else if
                  (report.status === 'Pending') { %>
                  <i class="fas fa-hourglass-half"></i> Pending <% } %>
                </span>
              </td>
              <td>
                <button title="Send Acknowledgment" class="icon-btn">
                  <i class="fas fa-paper-plane"></i>
                </button>
                <button title="Send Warning" class="icon-btn">
                  <i class="fas fa-exclamation-triangle"></i>
                </button>
                <button title="Resolve" class="icon-btn">
                  <i class="fas fa-check-circle"></i>
                </button>
              </td>
              <% }); %>
            </tr>
          </tbody>
        </table>
        <% } else { %>
        <div class="no-data">No reports found</div>
        <% } %>
      </div>

      <div id="reviewSection" style="display: none">
        <h2 class="page-title">Review Section</h2>
        <% if(allReviews && allReviews.length > 0) { %>
        <table class="data-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Email</th>
              <th>Subject</th>
              <th>Message</th>
            </tr>
          </thead>
          <tbody>
            <% allReviews.forEach(function(review) { %>
            <tr>
              <td><%= review.id %></td>
              <td><%= review.name %></td>
              <td><%= review.email %></td>
              <td><%= review.subject %></td>
              <td><%= review.message %></td>
            </tr>
            <% }); %>
          </tbody>
        </table>
        <% } else { %>
        <div class="no-data">No Reviews found</div>
        <% } %>
      </div>

      <footer class="footer">
        <p>© 2025 AdminPortal. All rights reserved.</p>
      </footer>
    </main>
    <script src="../js/adminPortal.js"></script>
  </body>
</html>
